<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Барная карта</title>
  {% load static %}
  <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  <link href="{% static 'css_restourant\restourant_drink.css' %}"></link>
  <link rel="icon" href="{% static 'img_restourant/free-icon-restaurant-562678.png' %}">
  <style>
    #header_block{
      display: flex;
      justify-content: center;
    }
    .link_header_item{
      padding: 5px;
      text-decoration: none;
      cursor: pointer;
      color:#F2F4F3;
      font-size: 22px;
    }
    .link_header_item:hover{
      text-decoration: underline #F2F4F3;
      text-decoration-thickness: 1.5px;
      text-underline-offset: 10px;
      transition: 0.7s;
    }
    .header{
      background-color: #0A0908;
      margin: 0;
      padding: 0;
    }
    body{
      margin: 0;
      background-color: #F2F4F3;
      color:#0A0908;
      padding: 0;
      font-family: 'Courier New', Courier, monospace;
    }
  </style>
</head>
<body>
  {% load static %}
  <header class="header p-3 sticky-top" id="header">
    <!-- Создаём контейнер для удобной верстки -->
    <div class="container-fluid">
      <div class="row">
        <!-- Создаём блок для всех кнопок header -->
        <div class="text-center col-12">
          <!-- Кнопка меню для перехода на другую страницу у header -->
          <a
            class="link_header_item mx-3 p-2"
            href="{% url 'home' %}"
            >Главная</a
          >
          <!-- Кнопка О нас для перехода на другую страницу у header -->
          <a class="link_header_item mx-3 p-2" href="{% url 'menu' %}"
            >Меню</a
          >
          <!-- Кнопка О нас для перехода на другую страницу у header -->
          <a class="link_header_item mx-3 p-2" href="{% url 'about' %}">Обращение</a>
          <a class="link_header_item mx-3 p-2" href="{% url 'rate' %}">Оценить нас</a>
          
          <!-- Кнопка Контакты для перехода на другую страницу у header -->
          <a class="link_header_item mx-3 p-2" href="#footer">Контакты</a>
        </div>
      </div>
    </div>
  </header>
  <main>
    <div class="container" id="container">
    </div>
  </main>

  <div class="container-fluid mt-5" style="background-color: #0A0908; color:#F2F4F3;" id="div_footer">
      <div class="row" style="display: flex; justify-content: space-around;">
        <div class="col-sm-12 col-md-6 col-lg-6 text-center mt-4 pb-3">
          <h4>Время работы</h4>
          <p>Понедельник-Пятница: с 9:00 до 21:00<br>
            Суббота: с 10:00 до 20:00<br>
            Воскресенье: с 10:00 до 18:00</p>
        </div>
        <div class="col-sm-12 col-md-6 col-lg-6 text-center mt-4 pb-3" style="margin-bottom: 50px;">
          <h4>Контакты</h4>
          <p>+7 (995) 792-67-95<br>+7 (986) 792-67-95<br>nirzzii@mail.ru</p>
          <a href="https://t.me/nirzzii"><img src="{% static 'img_restourant/icons/Иконка_телеграм.png' %}" alt="телеграм" height="40px"  width="40px"></a>
        </div>
        </div>
      </div>
    </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    const mainContainer = document.getElementById('container')
    async function getDrinkCount(){
      const responce = await fetch('/get_drink_count/');
      const data = await responce.json();
      return data.count;
    }

    async function AllDrink() {
      const count = await getDrinkCount();
      const categories = {}; // To keep track of category blocks
    
      for (var drinkid = 1; drinkid <= count; drinkid++) {
        const url = `/get-drink/${drinkid}/`;
        await getDrink(url, categories);
      }
    }
    
    async function getDrink(url, categories) {
      const response = await fetch(url);
      const data = await response.json();
      console.log(data);

    
      // Get or create the category block
      const categoryKey = data.drink_type_select;
      let categoryDiv = categories[categoryKey];
    
      if (!categoryDiv) {
        // Create the category block
        categoryDiv = document.createElement('div');
        categoryDiv.className = "row px-2 mt-5";
        categoryDiv.style.display = 'flex';
        categoryDiv.style.flexWrap = 'wrap'; // To handle multiple cards
        categoryDiv.style.justifyContent = 'space-around';
        categoryDiv.style.marginTop = '20px';
    
        // Create and append the h2 title
        const h2 = document.createElement('h2');
        h2.textContent = getCategoryName(categoryKey);
        categoryDiv.appendChild(h2);
    
        // Append categoryDiv to main container
        mainContainer.appendChild(categoryDiv);
    
        // Store in categories object
        categories[categoryKey] = categoryDiv;
      }
    
      // Now create the card and append to categoryDiv
      const cardDiv = document.createElement('div');
      cardDiv.className = "card mb-3";
      cardDiv.style.maxWidth = '540px';
      cardDiv.style.margin = '10px'; // Add some margin between cards
    
      const row = document.createElement('div');
      row.className = 'row g-0';
      cardDiv.appendChild(row);
    
      const colImg = document.createElement('div');
      colImg.className = 'col-md-4';
      row.appendChild(colImg);
    
      const img = document.createElement('img');
      img.className = 'img-fluid rounded-start w-100 h-100';
      img.style.objectFit = 'cover';
      img.alt = data.name;
      img.src = data.image_drink;
      colImg.appendChild(img);
    
      const colContent = document.createElement('div');
      colContent.className = 'col-md-8';
      row.appendChild(colContent);
    
      const cardBody = document.createElement('div');
      cardBody.className = 'card-body';
      colContent.appendChild(cardBody);
    
      const h5 = document.createElement('h5');
      h5.className = 'card-title';
      h5.style.fontWeight = 'bold';
      h5.textContent = data.name;
      cardBody.appendChild(h5);
    
      const pDescription = document.createElement('p');
      pDescription.className = 'card-text';
      pDescription.textContent = data.description_drink;
      cardBody.appendChild(pDescription);
    
      const pPrice = document.createElement('p');
      pPrice.className = 'card-text';
      pPrice.style.fontWeight = 'bold';
    
      const small = document.createElement('small');
      small.style.fontSize = '20px';
      small.className = 'text-body-secondary';
      small.textContent = `${data.price} рублей`;
      pPrice.appendChild(small);
      cardBody.appendChild(pPrice);
    
      const button = document.createElement('button');
      button.className = 'btn btn-primary button_card_detail';
      button.type = 'button';
      button.setAttribute('data-bs-toggle', 'offcanvas');
      const offcanvasId = 'offcanvasExample_' + data.name.replace(/\s/g, '_').toLowerCase();
      button.setAttribute('data-bs-target', '#' + offcanvasId);
      button.setAttribute('aria-controls', offcanvasId);
      button.textContent = 'Подробнее';
      cardBody.appendChild(button);
    
      categoryDiv.appendChild(cardDiv);

      button.addEventListener('click', function() {
        createOffcanvas(data);
      });
    }
    
    function createOffcanvas(data) {
      const offcanvasId = 'offcanvas_' + data.name.replace(/\s/g, '_').toLowerCase();
    
      // Check if the offcanvas already exists
      let existingOffcanvas = document.getElementById(offcanvasId);
      if (!existingOffcanvas) {
        // Create the offcanvas
        const offcanvasDiv = document.createElement('div');
        offcanvasDiv.className = 'offcanvas offcanvas-start';
        offcanvasDiv.setAttribute('tabindex', '-1');
        offcanvasDiv.id = offcanvasId;
        offcanvasDiv.setAttribute('aria-labelledby', 'offcanvasLabel_' + offcanvasId);
    
        const offcanvasHeader = document.createElement('div');
        offcanvasHeader.className = 'offcanvas-header';
        const closeButton = document.createElement('button');
        closeButton.className = 'btn-close';
        closeButton.setAttribute('data-bs-dismiss', 'offcanvas');
        closeButton.setAttribute('aria-label', 'Close');
        offcanvasHeader.appendChild(closeButton);
        offcanvasDiv.appendChild(offcanvasHeader);
    
        const offcanvasBody = document.createElement('div');
        offcanvasBody.className = 'offcanvas-body';
    
        const imgOffcanvas = document.createElement('img');
        imgOffcanvas.src = data.image_drink;
        imgOffcanvas.className = 'img-fluid';
        imgOffcanvas.style.maxHeight = '300px'; // Ограничиваем высоту до 300px
        imgOffcanvas.style.width = 'auto'; // Автоматическая ширина для сохранения пропорций
        imgOffcanvas.style.display = 'block'; // Центрируем изображение
        imgOffcanvas.style.margin = '0 auto';
        imgOffcanvas.alt = data.name;
        offcanvasBody.appendChild(imgOffcanvas);
    
        const ingredientsHeader = document.createElement('h4');
        ingredientsHeader.textContent = 'Ингредиенты';
        const caloriesandweight = document.createElement('h4');
        caloriesandweight.textContent = 'Калории и масса';
    
        const ingredientsList = document.createElement('ul');
        const callandweight = document.createElement('ul');

        // Используем обычный цикл for для перебора массива
        if (Array.isArray(data.structure_drink.ingredients)) {
          for (var i = 0; i < data.structure_drink.ingredients.length; i++) {
            const li = document.createElement('li');
            li.textContent = `${data.structure_drink.ingredients[i].name}: ${data.structure_drink.ingredients[i].quantity}`;
            ingredientsList.appendChild(li);
          }
        } else {
          const li = document.createElement('li');
          li.textContent = 'Ингредиенты не найдены';
          ingredientsList.appendChild(li);
        }
    
        // Добавляем калории и вес
        if (data.structure_drink.callories_weight && Array.isArray(data.structure_drink.callories_weight)) {
          const li_callories = document.createElement('li');
          const li_weight = document.createElement('li');
          li_callories.textContent = `Калории: ${data.structure_drink.callories_weight[0].callories}`;
          li_weight.textContent = `Вес: ${data.structure_drink.callories_weight[0].weight}`;
          callandweight.appendChild(li_callories);
          callandweight.appendChild(li_weight);
        } else {
          const li = document.createElement('li');
          li.textContent = 'Калории и масса не найдены';
          callandweight.appendChild(li);
        }

// Добавляем список ингредиентов в тело offcanvas
offcanvasBody.appendChild(ingredientsHeader);
offcanvasBody.appendChild(ingredientsList);
offcanvasBody.appendChild(caloriesandweight);
offcanvasBody.appendChild(callandweight);
offcanvasDiv.appendChild(offcanvasBody);
document.body.appendChild(offcanvasDiv);
}

    
      // Инициализируем offcanvas после добавления в DOM
      const offcanvasElement = new bootstrap.Offcanvas(document.getElementById(offcanvasId));
      offcanvasElement.show();
    }
    
    function getCategoryName(key) {
      const categories = {
        'champagne': 'Шампанское и игристые вина',
        'beer': 'Пиво',
        'strong_drinks': 'Крепкие напитки',
        'cocktails': 'Коктейли',
        'non_alcoholic': 'Безалкогольные напитки',
      };
      return categories[key] || 'Прочие';
    }
    
    AllDrink();
  </script>
</body>
</html>